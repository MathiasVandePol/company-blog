version: 0.1
workspace:
  type: "kubernetes"
  spec:
    image: bencdr/company-blog:latest
    container-based-vm: true
    cpu: 2
    memory: 2
    disk: 10
  configure:
    start:
      - name: "Configure nvm"
        command: /coder/configure_nvm.sh
      - name: "Clone the git repository, if it doesn't exist"
        env:
          GIT_REMOTE: git@github.com:bpmct/company-blog.git
          CLONE_TO: /home/coder/company-blog
        command: |
          # Check if the project directory already exists 
          if [ ! -d $CLONE_TO ]; then

            # 1. ensure we have GitHub's host key added to known_hosts
            touch ~/.ssh/known_hosts
            if ! ssh-keygen -F github.com > /dev/null; then
              ssh-keyscan github.com >> ~/.ssh/known_hosts 2> /dev/null
            fi
            
            2. Clone the project
            echo "$CLONE_TO is empty... Cloning"
            git clone $GIT_REMOTE $CLONE_TO

          else
            echo "$CLONE_TO exists âœ…"
          fi
  devURLs:
    - name: webblog
      port: 3000
      scheme: http
      access: private
